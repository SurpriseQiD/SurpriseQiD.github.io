<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="QiView">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="/img/2018-06-04-introducing-the-istio-v1alpha3-routing-api/background.jpg">
    <meta property="twitter:image" content="/img/2018-06-04-introducing-the-istio-v1alpha3-routing-api/background.jpg" />
    

    
    <meta name="title" content="è¿™é‡Œæ˜¯ä¸€ä¸ªæ ‡é¢˜" />
    <meta property="og:title" content="è¿™é‡Œæ˜¯ä¸€ä¸ªæ ‡é¢˜" />
    <meta property="twitter:title" content="è¿™é‡Œæ˜¯ä¸€ä¸ªæ ‡é¢˜" />
    

    
    <meta name="description" content="è¿™ä¸ªpostæ˜¯ä½œä¸ºæ¨¡æ¿">
    <meta property="og:description" content="è¿™ä¸ªpostæ˜¯ä½œä¸ºæ¨¡æ¿" />
    <meta property="twitter:description" content="è¿™ä¸ªpostæ˜¯ä½œä¸ºæ¨¡æ¿" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="Game Theory, Decision Science, Operations Management, Human-AI Interaction">
    <link rel="shortcut icon" href="/img/favicon.png">

    <title>è¿™é‡Œæ˜¯ä¸€ä¸ªæ ‡é¢˜ | QiView</title>

    <link rel="canonical" href="/post/introducing-the-istio-v1alpha3-routing-api/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link rel="stylesheet" href="/css/font-awesome.all.min.css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>



      <script async src="https://www.googletagmanager.com/gtag/js?id=G-CX84QDN0SR"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-CX84QDN0SR');
        }
      </script>





<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">QiView</a>
        </div>
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    
                        <li><a href="/">ğŸ  é¦–é¡µ</a></li>
                    
                        <li><a href="/knowledge/">ğŸ“š çŸ¥è¯†åº“</a></li>
                    
                        <li><a href="/learning/">ğŸ“– å­¦ä¹ è®°å½•</a></li>
                    
                        <li><a href="/research/">ğŸ”¬ ç ”ç©¶è¿›å±•</a></li>
                    
                        <li><a href="/resources/">ğŸ”— èµ„æºèšåˆ</a></li>
                    
                        <li><a href="/blog/">âœï¸ åšå®¢æ–‡ç« </a></li>
                    
                        <li><a href="/about/">ğŸ‘¤ å…³äºæˆ‘</a></li>
                    
                    <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>
<script>
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');
    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
            $navbar.className = " ";
            setTimeout(function(){
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>



<header class="intro-header" style="background-image: url('/img/home-bg-painting.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 ">
                <div class="site-heading">
                    <h1>QiView </h1>
                    
		    <span class="subheading"></span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">
            
            <div class="
            col-lg-8 col-lg-offset-1
            col-md-8 col-md-offset-1
            col-sm-12
            col-xs-12
            post-container">
            
                <p>æµ‹è¯•ç®€ä»‹</p>
<p>è™½ç„¶ç›®å‰APIçš„åŠŸèƒ½å·²è¢«è¯æ˜æ˜¯Istioéå¸¸å¼•äººæ³¨ç›®çš„ä¸€éƒ¨åˆ†ï¼Œä½†ç”¨æˆ·çš„åé¦ˆä¹Ÿè¡¨æ˜ï¼Œè¿™ä¸ªAPIç¡®å®æœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨å®ƒæ¥ç®¡ç†åŒ…å«æ•°åƒä¸ªæœåŠ¡çš„éå¸¸å¤§çš„åº”ç”¨ç¨‹åºï¼Œä»¥åŠä½¿ç”¨HTTPä»¥å¤–çš„åè®®æ—¶ã€‚ æ­¤å¤–ï¼Œä½¿ç”¨Kubernetes Ingressèµ„æºæ¥é…ç½®å¤–éƒ¨æµé‡çš„æ–¹å¼å·²è¢«è¯æ˜ä¸èƒ½æ»¡è¶³éœ€æ±‚ã€‚</p>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°ç¼ºé™·å’Œå…¶ä»–çš„ä¸€äº›é—®é¢˜ï¼ŒIstioå¼•å…¥äº†æ–°çš„æµé‡ç®¡ç†API v1alpha3ï¼Œæ–°ç‰ˆæœ¬çš„APIå°†å®Œå…¨å–ä»£ä¹‹å‰çš„APIã€‚ å°½ç®¡v1alpha3å’Œä¹‹å‰çš„æ¨¡å‹åœ¨æœ¬è´¨ä¸Šæ˜¯åŸºæœ¬ç›¸åŒçš„ï¼Œä½†å®ƒå¹¶ä¸å‘åå…¼å®¹çš„ï¼ŒåŸºäºæ—§APIçš„æ¨¡å‹éœ€è¦è¿›è¡Œæ‰‹åŠ¨è½¬æ¢ã€‚ Istioæ¥ä¸‹æ¥çš„å‡ ä¸ªç‰ˆæœ¬ä¸­ä¼šæä¾›ä¸€ä¸ªæ–°æ—§æ¨¡å‹çš„è½¬æ¢å·¥å…·ã€‚</p>
<p>ä¸ºäº†è¯æ˜è¯¥éå…¼å®¹å‡çº§çš„å¿…è¦æ€§ï¼Œv1alpha3 APIç»å†äº†æ¼«é•¿è€Œè‰°è‹¦çš„ç¤¾åŒºè¯„ä¼°è¿‡ç¨‹ï¼Œä»¥å¸Œæœ›æ–°çš„APIèƒ½å¤Ÿå¤§å¹…æ”¹è¿›ï¼Œå¹¶ç»å¾—èµ·æ—¶é—´è€ƒéªŒã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»æ–°çš„é…ç½®æ¨¡å‹ï¼Œå¹¶è¯•å›¾è§£é‡Šå…¶åé¢çš„ä¸€äº›åŠ¨æœºå’Œè®¾è®¡åŸåˆ™ã€‚</p>
<h2 id="è®¾è®¡åŸåˆ™">è®¾è®¡åŸåˆ™</h2>
<p>è·¯ç”±æ¨¡å‹çš„é‡æ„è¿‡ç¨‹ä¸­éµå¾ªäº†ä¸€äº›å…³é”®çš„è®¾è®¡åŸåˆ™ï¼š</p>
<ul>
<li>é™¤æ”¯æŒå£°æ˜å¼ï¼ˆæ„å›¾ï¼‰é…ç½®å¤–ï¼Œä¹Ÿæ”¯æŒæ˜¾å¼æŒ‡å®šæ¨¡å‹ä¾èµ–çš„åŸºç¡€è®¾æ–½ã€‚ä¾‹å¦‚ï¼Œé™¤äº†é…ç½®å…¥å£ç½‘å…³ï¼ˆçš„åŠŸèƒ½ç‰¹æ€§ï¼‰ä¹‹å¤–ï¼Œè´Ÿè´£å®ç° å…¥å£ç½‘å…³åŠŸèƒ½çš„ç»„ä»¶ï¼ˆControllerï¼‰ä¹Ÿå¯ä»¥åœ¨æ¨¡å‹æŒ‡å®šã€‚</li>
<li>ç¼–å†™æ¨¡å‹æ—¶åº”è¯¥â€œç”Ÿäº§è€…å¯¼å‘â€å’Œâ€œä»¥Hostä¸ºä¸­å¿ƒâ€ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»„åˆå¤šä¸ªè§„åˆ™æ¥ç¼–å†™æ¨¡å‹ã€‚ ä¾‹å¦‚ï¼Œæ‰€æœ‰ä¸ç‰¹å®šHostå…³è”çš„è§„åˆ™è¢«é…ç½®åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯å•ç‹¬é…ç½®ã€‚</li>
<li>å°†è·¯ç”±ä¸è·¯ç”±åè¡Œä¸ºæ¸…æ™°åˆ†å¼€ã€‚</li>
</ul>
<h2 id="v1alpha3ä¸­çš„é…ç½®èµ„æº">v1alpha3ä¸­çš„é…ç½®èµ„æº</h2>
<p>åœ¨ä¸€ä¸ªå…¸å‹çš„ç½‘æ ¼ä¸­ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç”¨äºç»ˆç»“å¤–éƒ¨TLSé“¾æ¥ï¼Œå°†æµé‡å¼•å…¥ç½‘æ ¼çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºgatewayï¼‰ã€‚ ç„¶åæµé‡é€šè¿‡è¾¹è½¦ç½‘å…³ï¼ˆsidecar gatewayï¼‰æµç»å†…éƒ¨æœåŠ¡ã€‚ åº”ç”¨ç¨‹åºä½¿ç”¨å¤–éƒ¨æœåŠ¡çš„æƒ…å†µä¹Ÿå¾ˆå¸¸è§ï¼ˆä¾‹å¦‚è®¿é—®Google Maps APIï¼‰ï¼Œä¸€äº›æƒ…å†µä¸‹ï¼Œè¿™äº›å¤–éƒ¨æœåŠ¡å¯èƒ½è¢«ç›´æ¥è°ƒç”¨ï¼›ä½†åœ¨æŸäº›éƒ¨ç½²ä¸­ï¼Œç½‘æ ¼ä¸­æ‰€æœ‰è®¿é—®å¤–éƒ¨æœåŠ¡çš„æµé‡å¯èƒ½è¢«è¦æ±‚å¼ºåˆ¶é€šè¿‡ä¸“ç”¨çš„å‡ºå£ç½‘å…³ï¼ˆEgress gatewayï¼‰ã€‚ ä¸‹å›¾æç»˜äº†ç½‘å…³åœ¨ç½‘æ ¼ä¸­çš„ä½¿ç”¨æƒ…å†µã€‚</p>
<p>
  <img src="/img/2018-06-04-introducing-the-istio-v1alpha3-routing-api/gateways.svg" alt="Gateway">

</p>
<p>è€ƒè™‘åˆ°ä¸Šè¿°å› ç´ ï¼Œ<code>v1alpha3</code>å¼•å…¥äº†ä»¥ä¸‹è¿™äº›æ–°çš„é…ç½®èµ„æºæ¥æ§åˆ¶è¿›å…¥ç½‘æ ¼ï¼Œç½‘æ ¼å†…éƒ¨å’Œç¦»å¼€ç½‘æ ¼çš„æµé‡è·¯ç”±ã€‚</p>
<ol>
<li><code>Gateway</code></li>
<li><code>VirtualService</code></li>
<li><code>DestinationRule</code></li>
<li><code>ServiceEntry</code></li>
</ol>
<p><code>VirtualService</code>ï¼Œ<code>DestinationRule</code>å’Œ<code>ServiceEntry</code>åˆ†åˆ«æ›¿æ¢äº†åŸAPIä¸­çš„<code>RouteRule</code>ï¼Œ<code>DestinationPolicy</code>å’Œ<code>EgressRule</code>ã€‚ <code>Gateway</code>æ˜¯ä¸€ä¸ªç‹¬ç«‹äºå¹³å°çš„æŠ½è±¡ï¼Œç”¨äºå¯¹æµå…¥ä¸“ç”¨ä¸­é—´è®¾å¤‡çš„æµé‡è¿›è¡Œå»ºæ¨¡ã€‚</p>
<p>ä¸‹å›¾æè¿°äº†è·¨å¤šä¸ªé…ç½®èµ„æºçš„æ§åˆ¶æµç¨‹ã€‚

  <img src="/img/2018-06-04-introducing-the-istio-v1alpha3-routing-api/virtualservices-destrules.svg" alt="ä¸åŒé…ç½®èµ„æºä¹‹é—´çš„å…³ç³»">

</p>
<h3 id="gateway">Gateway</h3>
<p><a href="https://istio.io/docs/reference/config/istio.networking.v1alpha3/#Gateway">Gateway</a>ç”¨äºä¸ºHTTP / TCPæµé‡é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶ä¸ç®¡è¯¥è´Ÿè½½å‡è¡¡å™¨å°†åœ¨å“ªé‡Œè¿è¡Œã€‚ ç½‘æ ¼ä¸­å¯ä»¥å­˜åœ¨ä»»æ„æ•°é‡çš„Gatewayï¼Œå¹¶ä¸”å¤šä¸ªä¸åŒçš„Gatewayå®ç°å¯ä»¥å…±å­˜ã€‚ å®é™…ä¸Šï¼Œé€šè¿‡åœ¨é…ç½®ä¸­æŒ‡å®šä¸€ç»„å·¥ä½œè´Ÿè½½ï¼ˆPodï¼‰æ ‡ç­¾ï¼Œå¯ä»¥å°†Gatewayé…ç½®ç»‘å®šåˆ°ç‰¹å®šçš„å·¥ä½œè´Ÿè½½ï¼Œä»è€Œå…è®¸ç”¨æˆ·é€šè¿‡ç¼–å†™ç®€å•çš„Gateway Controlleræ¥é‡ç”¨ç°æˆçš„ç½‘ç»œè®¾å¤‡ã€‚</p>
<p>å¯¹äºå…¥å£æµé‡ç®¡ç†ï¼Œæ‚¨å¯èƒ½ä¼šé—®ï¼š ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨Kubernetes Ingress API ï¼Ÿ åŸå› æ˜¯Ingress APIæ— æ³•è¡¨è¾¾Istioçš„è·¯ç”±éœ€æ±‚ã€‚ Ingressè¯•å›¾åœ¨ä¸åŒçš„HTTPä»£ç†ä¹‹é—´å–ä¸€ä¸ªå…¬å…±çš„äº¤é›†ï¼Œå› æ­¤åªèƒ½æ”¯æŒæœ€åŸºæœ¬çš„HTTPè·¯ç”±ï¼Œæœ€ç»ˆå¯¼è‡´éœ€è¦å°†ä»£ç†çš„å…¶ä»–é«˜çº§åŠŸèƒ½æ”¾å…¥åˆ°æ³¨è§£ï¼ˆannotationï¼‰ä¸­ï¼Œè€Œæ³¨è§£çš„æ–¹å¼åœ¨å¤šä¸ªä»£ç†ä¹‹é—´æ˜¯ä¸å…¼å®¹çš„ï¼Œæ— æ³•ç§»æ¤ã€‚</p>
<p>Istio <code>Gateway</code> é€šè¿‡å°†L4-L6é…ç½®ä¸L7é…ç½®åˆ†ç¦»çš„æ–¹å¼å…‹æœäº†<code>Ingress</code>çš„è¿™äº›ç¼ºç‚¹ã€‚ <code>Gateway</code>åªç”¨äºé…ç½®L4-L6åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œå¯¹å¤–å…¬å¼€çš„ç«¯å£ï¼ŒTLSé…ç½®ï¼‰ï¼Œæ‰€æœ‰ä¸»æµçš„L7ä»£ç†å‡ä»¥ç»Ÿä¸€çš„æ–¹å¼å®ç°äº†è¿™äº›åŠŸèƒ½ã€‚ ç„¶åï¼Œé€šè¿‡åœ¨<code>Gateway</code>ä¸Šç»‘å®š<code>VirtualService</code>çš„æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„Istioè§„åˆ™æ¥æ§åˆ¶è¿›å…¥<code>Gateway</code>çš„HTTPå’ŒTCPæµé‡ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸ªç®€å•çš„<code>Gateway</code>é…ç½®äº†ä¸€ä¸ªLoad Balancerï¼Œä»¥å…è®¸è®¿é—®host bookinfo.comçš„httpså¤–éƒ¨æµé‡å…¥meshä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: networking.istio.io/v1alpha3
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: Gateway
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: bookinfo-gateway
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">servers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">port</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">number</span>: <span style="color:#bd93f9">443</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">name</span>: https
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">protocol</span>: HTTPS
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">hosts</span>:
</span></span><span style="display:flex;"><span>    - bookinfo.com
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">tls</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">mode</span>: SIMPLE
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">serverCertificate</span>: /tmp/tls.crt
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">privateKey</span>: /tmp/tls.key
</span></span></code></pre></div><p>è¦ä¸ºè¿›å…¥ä¸Šé¢çš„Gatewayçš„æµé‡é…ç½®ç›¸åº”çš„è·¯ç”±ï¼Œå¿…é¡»ä¸ºåŒä¸€ä¸ªhostå®šä¹‰ä¸€ä¸ª<code>VirtualService</code>ï¼ˆåœ¨ä¸‹ä¸€èŠ‚ä¸­æè¿°ï¼‰ï¼Œå¹¶ä½¿ç”¨é…ç½®ä¸­çš„<code>gateways</code>å­—æ®µç»‘å®šåˆ°å‰é¢å®šä¹‰çš„<code>Gateway</code> ä¸Šï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: networking.istio.io/v1alpha3
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: VirtualService
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: bookinfo
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">hosts</span>:
</span></span><span style="display:flex;"><span>    - bookinfo.com
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">gateways</span>:
</span></span><span style="display:flex;"><span>  - bookinfo-gateway <span style="color:#6272a4"># &lt;---- bind to gateway</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">http</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">match</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">uri</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">prefix</span>: /reviews
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">route</span>:
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><p>Gatewayå¯ä»¥ç”¨äºå»ºæ¨¡è¾¹ç¼˜ä»£ç†æˆ–çº¯ç²¹çš„å†…éƒ¨ä»£ç†ï¼Œå¦‚ç¬¬ä¸€å¼ å›¾æ‰€ç¤ºã€‚ æ— è®ºåœ¨å“ªä¸ªä½ç½®ï¼Œæ‰€æœ‰ç½‘å…³éƒ½å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼è¿›è¡Œé…ç½®å’Œæ§åˆ¶ã€‚</p>
<h3 id="virtualservice">VirtualService</h3>
<p>ç”¨ä¸€ç§å«åšâ€œVirtual servicesâ€çš„ä¸œè¥¿ä»£æ›¿è·¯ç”±è§„åˆ™å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œä½†å¯¹äºå®ƒé…ç½®çš„å†…å®¹è€Œè¨€ï¼Œè¿™äº‹å®ä¸Šæ˜¯ä¸€ä¸ªæ›´å¥½çš„åç§°ï¼Œç‰¹åˆ«æ˜¯åœ¨é‡æ–°è®¾è®¡APIä»¥è§£å†³å…ˆå‰æ¨¡å‹çš„å¯æ‰©å±•æ€§é—®é¢˜ä¹‹åã€‚</p>
<p>å®é™…ä¸Šï¼Œå‘ç”Ÿçš„å˜åŒ–æ˜¯ï¼šåœ¨ä¹‹å‰çš„æ¨¡å‹ä¸­ï¼Œéœ€è¦ç”¨ä¸€ç»„ç›¸äº’ç‹¬ç«‹çš„é…ç½®è§„åˆ™æ¥ä¸ºç‰¹å®šçš„ç›®çš„æœåŠ¡è®¾ç½®è·¯ç”±è§„åˆ™ï¼Œå¹¶é€šè¿‡precedenceå­—æ®µæ¥æ§åˆ¶è¿™äº›è§„åˆ™çš„é¡ºåºï¼›åœ¨æ–°çš„APIä¸­ï¼Œåˆ™ç›´æ¥å¯¹ï¼ˆè™šæ‹Ÿï¼‰æœåŠ¡è¿›è¡Œé…ç½®ï¼Œè¯¥è™šæ‹ŸæœåŠ¡çš„æ‰€æœ‰è§„åˆ™ä»¥ä¸€ä¸ªæœ‰åºåˆ—è¡¨çš„æ–¹å¼é…ç½®åœ¨å¯¹åº”çš„<a href="/docs/reference/config/istio.networking.v1alpha3/#VirtualService">VirtualService</a> èµ„æºä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¹‹å‰åœ¨<a href="/docs/guides/bookinfo/">Bookinfo</a> åº”ç”¨ç¨‹åºçš„reviewsæœåŠ¡ä¸­æœ‰ä¸¤ä¸ªRouteRuleèµ„æºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: config.istio.io/v1alpha2
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: RouteRule
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: reviews-default
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">destination</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">name</span>: reviews
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">precedence</span>: <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">route</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">labels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">version</span>: v1
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: config.istio.io/v1alpha2
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: RouteRule
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: reviews-test-v2
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">destination</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">name</span>: reviews
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">precedence</span>: <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">match</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">request</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">headers</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">cookie</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">regex</span>: <span style="color:#f1fa8c">&#34;^(.*?;)?(user=jason)(;.*)?$&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">route</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">labels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">version</span>: v2
</span></span></code></pre></div><p>åœ¨<code>v1alph3</code>ï¼Œå¯ä»¥åœ¨å•ä¸ª<code>VirtualService</code>èµ„æºä¸­æä¾›ç›¸åŒçš„é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: networking.istio.io/v1alpha3
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: VirtualService
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: reviews
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">hosts</span>:
</span></span><span style="display:flex;"><span>    - reviews
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">http</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">match</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">headers</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">cookie</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">regex</span>: <span style="color:#f1fa8c">&#34;^(.*?;)?(user=jason)(;.*)?$&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">route</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">destination</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">host</span>: reviews
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">subset</span>: v2
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">route</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">destination</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">host</span>: reviews
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">subset</span>: v1
</span></span></code></pre></div><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œ å’ŒreviewsæœåŠ¡ç›¸å…³çš„ä¸¤ä¸ªè§„åˆ™é›†ä¸­å†™åœ¨äº†ä¸€ä¸ªåœ°æ–¹ã€‚è¿™ä¸ªæ”¹å˜ä¹ä¸€çœ‹å¯èƒ½è§‰å¾—å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ä¼˜åŠ¿ï¼Œ ç„¶è€Œï¼Œå¦‚æœä»”ç»†è§‚å¯Ÿè¿™ä¸ªæ–°æ¨¡å‹ï¼Œä¼šå‘ç°å®ƒå’Œä¹‹å‰çš„APIä¹‹é—´å­˜åœ¨ç€æ ¹æœ¬çš„å·®å¼‚ï¼Œè¿™ä½¿å¾—v1alpha3åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚</p>
<p>é¦–å…ˆï¼Œè¯·æ³¨æ„<code>VirtualService</code>çš„ç›®æ ‡æœåŠ¡æ˜¯ä½¿ç”¨<code>hosts</code>å­—æ®µï¼ˆå®é™…ä¸Šæ˜¯é‡å¤å­—æ®µï¼‰æŒ‡å®šçš„ï¼Œç„¶åå†åœ¨æ¯ä¸ªè·¯ç”±çš„<code>destination</code>å­—æ®µä¸­æŒ‡å®šã€‚ è¿™æ˜¯ä¸ä»¥å‰æ¨¡å‹çš„é‡è¦åŒºåˆ«ã€‚</p>
<p><code>VirtualService</code>æè¿°äº†ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·å¯å¯»å€ç›®æ ‡åˆ°ç½‘æ ¼å†…å®é™…å·¥ä½œè´Ÿè½½ä¹‹é—´çš„æ˜ å°„ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè¿™ä¸¤ä¸ªåœ°å€æ˜¯ç›¸åŒçš„ï¼Œä½†å®é™…ä¸Šç”¨æˆ·å¯å¯»å€ç›®æ ‡å¯ä»¥æ˜¯ä»»ä½•ç”¨äºå®šä½æœåŠ¡çš„ï¼Œå…·æœ‰å¯é€‰é€šé…ç¬¦å‰ç¼€æˆ–CIDRå‰ç¼€çš„DNSåç§°ã€‚
è¿™å¯¹äºåº”ç”¨ä»å•ä½“æ¶æ„åˆ°å¾®æœåŠ¡æ¶æ„çš„è¿ç§»è¿‡ç¨‹ç‰¹åˆ«æœ‰ç”¨ï¼Œå•ä½“åº”ç”¨è¢«æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åï¼Œé‡‡ç”¨VirtaulServiceå¯ä»¥ç»§ç»­æŠŠå¤šä¸ªå¾®æœåŠ¡å¯¹å¤–æš´éœ²ä¸ºåŒä¸€ä¸ªç›®æ ‡åœ°å€ï¼Œè€Œä¸éœ€è¦æœåŠ¡æ¶ˆè´¹è€…è¿›è¡Œä¿®æ”¹ä»¥é€‚åº”è¯¥å˜åŒ–ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹è§„åˆ™å…è®¸æœåŠ¡æ¶ˆè´¹è€…è®¿é—®Bookinfoåº”ç”¨ç¨‹åºçš„reviewså’ŒratingsæœåŠ¡ï¼Œå°±å¥½åƒå®ƒä»¬æ˜¯<code>http://bookinfo.com/</code>ï¼ˆè™šæ‹Ÿï¼‰æœåŠ¡çš„ä¸€éƒ¨åˆ†ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: networking.istio.io/v1alpha3
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: VirtualService
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: bookinfo
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">hosts</span>:
</span></span><span style="display:flex;"><span>    - bookinfo.com
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">http</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">match</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">uri</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">prefix</span>: /reviews
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">route</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">destination</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">host</span>: reviews
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">match</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">uri</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">prefix</span>: /ratings
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">route</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">destination</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">host</span>: ratings
</span></span><span style="display:flex;"><span>  ...
</span></span></code></pre></div><p>å®é™…ä¸Šåœ¨ï½€VirtualServiceï½€ä¸­hostséƒ¨åˆ†è®¾ç½®åªæ˜¯è™šæ‹Ÿçš„ç›®çš„åœ°,å› æ­¤ä¸ä¸€å®šæ˜¯å·²åœ¨ç½‘æ ¼ä¸­æ³¨å†Œçš„æœåŠ¡ã€‚è¿™å…è®¸ç”¨æˆ·ä¸ºåœ¨ç½‘æ ¼å†…æ²¡æœ‰å¯è·¯ç”±æ¡ç›®çš„è™šæ‹Ÿä¸»æœºçš„æµé‡è¿›è¡Œå»ºæ¨¡ã€‚ é€šè¿‡å°†<code>VirtualService</code>ç»‘å®šåˆ°åŒä¸€Hostçš„<code>Gateway</code>é…ç½®ï¼ˆå¦‚å‰ä¸€èŠ‚æ‰€è¿° ï¼‰ï¼Œå¯å‘ç½‘æ ¼å¤–éƒ¨æš´éœ²è¿™äº›Hostã€‚</p>
<p>é™¤äº†è¿™ä¸ªé‡å¤§çš„é‡æ„ä¹‹å¤–ï¼Œ <code>VirtualService</code>è¿˜åŒ…æ‹¬å…¶ä»–ä¸€äº›é‡è¦çš„æ”¹å˜ï¼š</p>
<ol>
<li>
<p>å¯ä»¥åœ¨<code>VirtualService</code>é…ç½®ä¸­è¡¨ç¤ºå¤šä¸ªåŒ¹é…æ¡ä»¶ï¼Œä»è€Œå‡å°‘å¯¹å†—ä½™çš„è§„åˆ™è®¾ç½®ã€‚</p>
</li>
<li>
<p>æ¯ä¸ªæœåŠ¡ç‰ˆæœ¬éƒ½æœ‰ä¸€ä¸ªåç§°ï¼ˆç§°ä¸ºæœåŠ¡å­é›†ï¼‰ã€‚ å±äºæŸä¸ªå­é›†çš„ä¸€ç»„Pod/VMåœ¨<code>DestinationRule</code>å®šä¹‰ï¼Œå…·ä½“å®šä¹‰å‚è§ä¸‹èŠ‚ã€‚</p>
</li>
<li>
<p>é€šè¿‡ä½¿ç”¨å¸¦é€šé…ç¬¦å‰ç¼€çš„DNSæ¥æŒ‡å®š<code>VirtualService</code>çš„hostï¼Œå¯ä»¥åˆ›å»ºå•ä¸ªè§„åˆ™ä»¥ä½œç”¨äºæ‰€æœ‰åŒ¹é…çš„æœåŠ¡ã€‚ ä¾‹å¦‚ï¼Œåœ¨Kubernetesä¸­ï¼Œåœ¨&rsquo;VirtualService&rsquo;ä¸­ä½¿ç”¨*.foo.svc.cluster.localä½œä¸ºhost,å¯ä»¥å¯¹<code>foo</code>å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰æœåŠ¡åº”ç”¨ç›¸åŒçš„é‡å†™è§„åˆ™ã€‚</p>
</li>
</ol>
<h3 id="destinationrule">DestinationRule</h3>
<p><a href="https://istio.io/docs/reference/config/istio.networking.v1alpha3/#DestinationRule">DestinationRule</a>é…ç½®å°†æµé‡è½¬å‘åˆ°æœåŠ¡æ—¶åº”ç”¨çš„ç­–ç•¥é›†ã€‚ è¿™äº›ç­–ç•¥åº”ç”±ç”±æœåŠ¡æä¾›è€…æ’°å†™ï¼Œç”¨äºæè¿°æ–­è·¯å™¨ï¼Œè´Ÿè½½å‡è¡¡è®¾ç½®ï¼ŒTLSè®¾ç½®ç­‰ã€‚
é™¤äº†ä¸‹è¿°æ”¹å˜å¤–ï¼Œ<code>DestinationRule</code>ä¸å…¶å‰èº«<code>DestinationPolicy</code>å¤§è‡´ç›¸åŒã€‚</p>
<ol>
<li><a href="https://istio.io/docs/reference/config/istio.networking.v1alpha3/#DestinationRule">DestinationRule</a>çš„<code>host</code>å¯ä»¥åŒ…å«é€šé…ç¬¦å‰ç¼€ï¼Œä»¥å…è®¸å•ä¸ªè§„åˆ™åº”ç”¨äºå¤šä¸ªæœåŠ¡ã€‚</li>
<li><code>DestinationRule</code>å®šä¹‰äº†ç›®çš„hostçš„å­é›†<code>subsets</code> ï¼ˆä¾‹å¦‚ï¼šå‘½åç‰ˆæœ¬ï¼‰ã€‚ è¿™äº›subsetç”¨äºï½€VirtualServiceï½€çš„è·¯ç”±è§„åˆ™è®¾ç½®ä¸­ï¼Œå¯ä»¥å°†æµé‡å¯¼å‘æœåŠ¡çš„æŸäº›ç‰¹å®šç‰ˆæœ¬ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ä¸ºç‰ˆæœ¬å‘½ååï¼Œå¯ä»¥åœ¨ä¸åŒçš„virtual serviceä¸­æ˜ç¡®åœ°å¼•ç”¨è¿™äº›å‘½åç‰ˆæœ¬çš„ubsetï¼Œç®€åŒ–Istioä»£ç†å‘å‡ºçš„ç»Ÿè®¡æ•°æ®ï¼Œå¹¶å¯ä»¥å°†subsetsç¼–ç åˆ°SNIå¤´ä¸­ã€‚
ä¸ºreviewsæœåŠ¡é…ç½®ç­–ç•¥å’Œsubsetsçš„<code>DestinationRule</code>å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: networking.istio.io/v1alpha3
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: DestinationRule
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: reviews
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">host</span>: reviews
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">trafficPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">loadBalancer</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">simple</span>: RANDOM
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">subsets</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">name</span>: v1
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">labels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">version</span>: v1
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">name</span>: v2
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">labels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">version</span>: v2
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">trafficPolicy</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">loadBalancer</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">simple</span>: ROUND_ROBIN
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">name</span>: v3
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">labels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">version</span>: v3
</span></span></code></pre></div><p>æ³¨æ„ï¼Œä¸<code>DestinationPolicy</code>ä¸åŒçš„æ˜¯ï¼Œå¯åœ¨å•ä¸ª<code>DestinationRule</code>ä¸­æŒ‡å®šå¤šä¸ªç­–ç•¥ï¼ˆä¾‹å¦‚ä¸Šé¢å®ä¾‹ä¸­çš„ç¼ºçœç­–ç•¥å’Œv2ç‰ˆæœ¬ç‰¹å®šçš„ç­–ç•¥ï¼‰ã€‚</p>
<h3 id="serviceentry">ServiceEntry</h3>
<p><a href="https://istio.io/docs/reference/config/istio.networking.v1alpha3/#ServiceEntry">ServiceEntry</a>ç”¨äºå°†é™„åŠ æ¡ç›®æ·»åŠ åˆ°Istioå†…éƒ¨ç»´æŠ¤çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­ã€‚
å®ƒæœ€å¸¸ç”¨äºå¯¹è®¿é—®ç½‘æ ¼å¤–éƒ¨ä¾èµ–çš„æµé‡è¿›è¡Œå»ºæ¨¡ï¼Œä¾‹å¦‚è®¿é—®Webä¸Šçš„APIæˆ–é—ç•™åŸºç¡€è®¾æ–½ä¸­çš„æœåŠ¡ã€‚</p>
<p>æ‰€æœ‰ä»¥å‰ä½¿ç”¨<code>EgressRule</code>è¿›è¡Œé…ç½®çš„å†…å®¹éƒ½å¯ä»¥é€šè¿‡<code>ServiceEntry</code>è½»æ¾å®Œæˆã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼è¿™æ ·çš„é…ç½®æ¥å…è®¸ä»ç½‘æ ¼å†…éƒ¨è®¿é—®ä¸€ä¸ªç®€å•çš„å¤–éƒ¨æœåŠ¡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: networking.istio.io/v1alpha3
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: ServiceEntry
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: foo-ext
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">hosts</span>:
</span></span><span style="display:flex;"><span>  - foo.com
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">number</span>: <span style="color:#bd93f9">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">name</span>: http
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">protocol</span>: HTTP
</span></span></code></pre></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>ServiceEntry</code>æ¯”å®ƒçš„å‰èº«å…·æœ‰æ›´å¤šçš„åŠŸèƒ½ã€‚é¦–å…ˆï¼Œ<code>ServiceEntry</code>ä¸é™äºå¤–éƒ¨æœåŠ¡é…ç½®ï¼Œå®ƒå¯ä»¥æœ‰ä¸¤ç§ç±»å‹ï¼šç½‘æ ¼å†…éƒ¨æˆ–ç½‘æ ¼å¤–éƒ¨ã€‚ç½‘æ ¼å†…éƒ¨æ¡ç›®åªæ˜¯ç”¨äºå‘ç½‘æ ¼æ˜¾å¼æ·»åŠ æœåŠ¡ï¼Œæ·»åŠ çš„æœåŠ¡ä¸å…¶ä»–å†…éƒ¨æœåŠ¡ä¸€æ ·ã€‚é‡‡ç”¨ç½‘æ ¼å†…éƒ¨æ¡ç›®ï¼Œå¯ä»¥æŠŠåŸæœ¬æœªè¢«ç½‘æ ¼ç®¡ç†çš„åŸºç¡€è®¾æ–½ä¹Ÿçº³å…¥åˆ°ç½‘æ ¼ä¸­ï¼ˆä¾‹å¦‚ï¼ŒæŠŠè™šæœºä¸­çš„æœåŠ¡æ·»åŠ åˆ°åŸºäºKubernetesçš„æœåŠ¡ç½‘æ ¼ä¸­ï¼‰ã€‚ç½‘æ ¼å¤–éƒ¨æ¡ç›®åˆ™ä»£è¡¨äº†ç½‘æ ¼å¤–éƒ¨çš„æœåŠ¡ã€‚å¯¹äºè¿™äº›å¤–éƒ¨æœåŠ¡æ¥è¯´ï¼ŒmTLSèº«ä»½éªŒè¯æ˜¯ç¦ç”¨çš„ï¼Œå¹¶ä¸”ç­–ç•¥æ˜¯åœ¨å®¢æˆ·ç«¯æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨åƒå†…éƒ¨æœåŠ¡è¯·æ±‚ä¸€æ ·åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œç­–ç•¥ã€‚</p>
<p>ç”±äº<code>ServiceEntry</code>é…ç½®åªæ˜¯å°†æœåŠ¡æ·»åŠ åˆ°ç½‘æ ¼å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­ï¼Œå› æ­¤å®ƒå¯ä»¥åƒæ³¨å†Œè¡¨ä¸­çš„ä»»ä½•å…¶ä»–æœåŠ¡ä¸€æ ·,ä¸<code>VirtualService</code>å’Œ/æˆ–<code>DestinationRule</code>ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹<code>DestinationRule</code>å¯ç”¨äºå¯åŠ¨å¤–éƒ¨æœåŠ¡çš„mTLSè¿æ¥ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">apiVersion</span>: networking.istio.io/v1alpha3
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kind</span>: DestinationRule
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: foo-ext
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">name</span>: foo.com
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">trafficPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">tls</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">mode</span>: MUTUAL
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">clientCertificate</span>: /etc/certs/myclientcert.pem
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">privateKey</span>: /etc/certs/client_private_key.pem
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">caCertificates</span>: /etc/certs/rootcacerts.pem
</span></span></code></pre></div><p>é™¤äº†æ‰©å±•é€šç”¨æ€§ä»¥å¤–ï¼Œ<code>ServiceEntry</code>è¿˜æä¾›äº†å…¶ä»–ä¸€äº›æœ‰å…³<code>EgressRule</code>æ”¹è¿›ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p>
<ol>
<li>ä¸€ä¸ª<code>ServiceEntry</code>å¯ä»¥é…ç½®å¤šä¸ªæœåŠ¡ç«¯ç‚¹ï¼Œè¿™åœ¨ä¹‹å‰éœ€è¦é‡‡ç”¨å¤šä¸ª<code>EgressRules</code>æ¥å®ç°ã€‚</li>
<li>ç°åœ¨å¯ä»¥é…ç½®æœåŠ¡ç«¯ç‚¹çš„è§£ææ¨¡å¼ï¼ˆ<code>NONE</code>ï¼Œ<code>STATIC</code>æˆ–<code>DNS</code>ï¼‰ã€‚</li>
<li>æ­¤å¤–ï¼Œæˆ‘ä»¬æ­£åœ¨åŠªåŠ›è§£å†³å¦ä¸€ä¸ªéš¾é¢˜ï¼šç›®å‰éœ€è¦é€šè¿‡çº¯æ–‡æœ¬ç«¯å£è®¿é—®å®‰å…¨çš„å¤–éƒ¨æœåŠ¡ï¼ˆä¾‹å¦‚<code>http://google.com:443</code>ï¼‰ã€‚è¯¥é—®é¢˜å°†ä¼šåœ¨æœªæ¥å‡ å‘¨å†…å¾—åˆ°è§£å†³ï¼Œå±Šæ—¶å°†å…è®¸ä»åº”ç”¨ç¨‹åºç›´æ¥è®¿é—®<code>https://google.com</code>ã€‚è¯·ç»§ç»­å…³æ³¨è§£å†³æ­¤é™åˆ¶çš„Istioè¡¥ä¸ç‰ˆæœ¬ï¼ˆ0.8.xï¼‰ã€‚</li>
</ol>
<h2 id="åˆ›å»ºå’Œåˆ é™¤v1alpha3è·¯ç”±è§„åˆ™">åˆ›å»ºå’Œåˆ é™¤v1alpha3è·¯ç”±è§„åˆ™</h2>
<p>ç”±äºä¸€ä¸ªç‰¹å®šç›®çš„åœ°çš„æ‰€æœ‰è·¯ç”±è§„åˆ™ç°åœ¨éƒ½å­˜å‚¨åœ¨å•ä¸ª<code>VirtualService</code>èµ„æºçš„ä¸€ä¸ªæœ‰åºåˆ—è¡¨ä¸­ï¼Œå› æ­¤ä¸ºè¯¥ç›®çš„åœ°æ·»åŠ æ–°çš„è§„åˆ™ä¸éœ€è¦å†åˆ›å»ºæ–°çš„<code>RouteRule</code>ï¼Œè€Œæ˜¯é€šè¿‡æ›´æ–°è¯¥ç›®çš„åœ°çš„<code>VirtualService</code>èµ„æºæ¥å®ç°ã€‚</p>
<p>æ—§çš„è·¯ç”±è§„åˆ™ï¼š</p>
<pre tabindex="0"><code class="language-command" data-lang="command">$ istioctl create -f my-second-rule-for-destination-abc.yaml
</code></pre><p><code>v1alpha3</code>è·¯ç”±è§„åˆ™ï¼š</p>
<pre tabindex="0"><code class="language-command" data-lang="command">$ istioctl replace -f my-updated-rules-for-destination-abc.yaml
</code></pre><p>åˆ é™¤è·¯ç”±è§„åˆ™ä¹Ÿä½¿ç”¨istioctl replaceå®Œæˆï¼Œå½“ç„¶åˆ é™¤æœ€åä¸€ä¸ªè·¯ç”±è§„åˆ™é™¤å¤–ï¼ˆåˆ é™¤æœ€åä¸€ä¸ªè·¯ç”±è§„åˆ™éœ€è¦åˆ é™¤<code>VirtualService</code>ï¼‰ã€‚</p>
<p>åœ¨æ·»åŠ æˆ–åˆ é™¤å¼•ç”¨æœåŠ¡ç‰ˆæœ¬çš„è·¯ç”±æ—¶ï¼Œéœ€è¦åœ¨è¯¥æœåŠ¡ç›¸åº”çš„<code>DestinationRule</code>æ›´æ–°subsets ã€‚ æ­£å¦‚ä½ å¯èƒ½çŒœåˆ°çš„ï¼Œè¿™ä¹Ÿæ˜¯ä½¿ç”¨<code>istioctl replace</code>å®Œæˆçš„ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Istio <code>v1alpha3</code>è·¯ç”±APIå…·æœ‰æ¯”å…¶å‰èº«æ›´å¤šçš„åŠŸèƒ½ï¼Œä½†ä¸å¹¸çš„æ˜¯æ–°çš„APIå¹¶ä¸å‘åå…¼å®¹ï¼Œæ—§çš„æ¨¡å‹å‡çº§éœ€è¦ä¸€æ¬¡æ‰‹åŠ¨è½¬æ¢ã€‚ Istio 0.9ä»¥åå°†ä¸å†æ”¯æŒ<code>RouteRule</code>ï¼Œ<code>DesintationPolicy</code>å’Œ<code>EgressRule</code>è¿™äº›ä»¥å‰çš„é…ç½®èµ„æº ã€‚Kubernetesç”¨æˆ·å¯ä»¥ç»§ç»­ä½¿ç”¨<code>Ingress</code>é…ç½®è¾¹ç¼˜è´Ÿè½½å‡è¡¡å™¨æ¥å®ç°åŸºæœ¬çš„è·¯ç”±ã€‚ ä½†æ˜¯ï¼Œé«˜çº§è·¯ç”±åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œè·¨ä¸¤ä¸ªç‰ˆæœ¬çš„æµé‡åˆ†å‰²ï¼‰åˆ™éœ€è¦ä½¿<code>ç”¨Gateway</code> ï¼Œè¿™æ˜¯ä¸€ç§åŠŸèƒ½æ›´å¼ºå¤§ï¼ŒIstioæ¨èçš„<code>Ingress</code>æ›¿ä»£å“ã€‚</p>
<h2 id="è‡´è°¢">è‡´è°¢</h2>
<p>æ„Ÿè°¢ä»¥ä¸‹äººå‘˜ä¸ºæ–°ç‰ˆæœ¬çš„è·¯ç”±æ¨¡å‹é‡æ„å’Œå®ç°å·¥ä½œåšå‡ºçš„è´¡çŒ®ï¼ˆæŒ‰å­—æ¯é¡ºåºï¼‰</p>
<ul>
<li>Frank Budinsky (IBM)</li>
<li>Zack Butcher (Google)</li>
<li>Greg Hanson (IBM)</li>
<li>Costin Manolache (Google)</li>
<li>Martin Ostrowski (Google)</li>
<li>Shriram Rajagopalan (VMware)</li>
<li>Louis Ryan (Google)</li>
<li>Isaiah Snell-Feikema (IBM)</li>
<li>Kuat Yessenov (Google)</li>
</ul>
<h2 id="åŸæ–‡">åŸæ–‡</h2>
<ul>
<li><a href="https://kubernetes.io/blog/2018/01/extensible-admission-is-beta">Introducing the Istio v1alpha3 routing API</a></li>
</ul>
            
             
            




<link href="https://xxx.xxx.com/dist/Artalk.css" rel="stylesheet" />
<script src="https://xxx.xxx.com/dist/Artalk.js"></script>


<div id="Comments"></div>

<script>
    Artalk.init({
        el: '#Comments',
        pageKey: 'https:\/\/SurpriseQiD.github.io\/post\/introducing-the-istio-v1alpha3-routing-api\/',
        pageTitle: 'è¿™é‡Œæ˜¯ä¸€ä¸ªæ ‡é¢˜',
        server: 'https:\/\/xxx.xxx.com',
        site: 'xxx blog',
    })
</script>


            
            </div>
            
            


<div class="
    col-lg-3 col-lg-offset-0
    col-md-3 col-md-offset-0
    col-sm-12
    col-xs-12
    sidebar-container
">

    
    <section>
        <hr>
        <h5>ç«™ç‚¹ç›®å½•</h5>
        <ul class="list-unstyled">
            
            
                <li><a href="/">ğŸ  é¦–é¡µ</a></li>
            
                <li><a href="/knowledge/">ğŸ“š çŸ¥è¯†åº“</a></li>
            
                <li><a href="/learning/">ğŸ“– å­¦ä¹ è®°å½•</a></li>
            
                <li><a href="/research/">ğŸ”¬ ç ”ç©¶è¿›å±•</a></li>
            
                <li><a href="/resources/">ğŸ”— èµ„æºèšåˆ</a></li>
            
                <li><a href="/blog/">âœï¸ åšå®¢æ–‡ç« </a></li>
            
                <li><a href="/about/">ğŸ‘¤ å…³äºæˆ‘</a></li>
            

            
            
                
                <li class="">
                    <a href="/research/">Research</a>
                    
                </li>
            
                
                <li class="">
                    <a href="/learning/">å­¦ä¹ è®°å½•</a>
                    
                </li>
            
                
                <li class="">
                    <a href="/knowledge/">çŸ¥è¯†åº“</a>
                    
                </li>
            
                
                <li class="active">
                    <a href="/blog/">Posts</a>
                    
                </li>
            
                
                <li class="">
                    <a href="/resources/">èµ„æºé“¾æ¥</a>
                    
                </li>
            
                
                <li class="">
                    <a href="/search/">Searches</a>
                    
                </li>
            
        </ul>
    </section>

    
    
    <section class="visible-md visible-lg">
        <div class="short-about">
            
            <a href="/about">
               <img src="/img/avatar-patrickStar.jpg" alt="avatar" style="cursor: pointer" />
            </a>
            
            
                <p>Ph.D. Candidate at University of Science and Technology of China</p>
            
           
           <ul class="list-inline">
               
               <li>
                   <a href="mailto:dongq@mail.ustc.edu.cn">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                      </span>
                   </a>
               </li>
               
               
               <li>
                   <a target="_blank" href="https://github.com/SurpriseQiD">
                       <span class="fa-stack fa-lg">
                           <i class="fas fa-circle fa-stack-2x"></i>
                           <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                       </span>
                   </a>
               </li>
               
               
           </ul>
        </div>
    </section>
    

    
    

    
    <section>
        <hr class="hidden-sm hidden-xs">
        <h5>FEATURED TAGS</h5>
        <div class="tags">
            
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
        </div>
    </section>
    

    

</div>

        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="mailto:dongq@mail.ustc.edu.cn">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/SurpriseQiD">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="QiView" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
            
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; QiView 2025
                    
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>



<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https'){
       bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else{
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>


<script>
    
    var _baId = '21326675';

    
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>



<span id="total-views" class="site-counter">
  <i class="fa fa-eye"></i>
  <span class="leancloud-total-views"></span>
</span>

<script>
  
  function showTotalViews() {
    var SiteCounter = AV.Object.extend("SiteCounter");
    var query = new AV.Query(SiteCounter);
    query.first().then(function (counter) {
      var totalViews = counter ? counter.get("totalViews") : 0;
      document.querySelector('.leancloud-total-views').textContent = totalViews;
    });
  }
  showTotalViews(); 
</script>



<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow" title="' + t + '">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





    
</body>
</html>
